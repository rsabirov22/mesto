(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const t=function(){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=n,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}var n,r;return n=t,(r=[{key:"_showInputError",value:function(e,t){var n=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),n.textContent=t,n.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(e){var t=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}},{key:"_isValid",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_hasInvalidInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"toggleButtonState",value:function(){this._hasInvalidInput(this._inputList)?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled","disabled")):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled","disabled"))}},{key:"_setEventListeners",value:function(){var e=this;this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._isValid(t),e.toggleButtonState()}))}))}},{key:"resetErrors",value:function(){var e=this;this._inputList.forEach((function(t){e._hideInputError(t)}))}},{key:"enableValidation",value:function(){this._setEventListeners()}}])&&e(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),t}();var n=document.querySelector(".content"),r=n.querySelector(".profile__edit-button"),o=n.querySelector(".profile__add-button"),i=n.querySelector(".profile__avatar-container"),a=document.querySelector(".popup_edit"),l=document.querySelector(".popup_add"),c=document.querySelector(".popup_avatar"),u=a.querySelector(".popup__form"),s=l.querySelector(".popup__form_add-card"),f=c.querySelector(".popup__form_change-avatar"),p=a.querySelector("#nickname"),h=a.querySelector("#job"),_=(l.querySelector("#card-name"),l.querySelector("#img-link"),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"});function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const y=function(){function e(t,n,r,o,i,a){var l,c,u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c=function(){u._handlePutLike(u._id).then((function(e){u._likes=e.likes})).catch((function(e){return console.log(e)}))},(l="_handleLikeClick")in this?Object.defineProperty(this,l,{value:c,enumerable:!0,configurable:!0,writable:!0}):this[l]=c,this._title=t.name,this._image=t.link,this._likes=t.likes,this._id=t._id,this._ownerId=t.owner._id,this._handleCardClick=r,this._handleDeleteCard=a,this._handlePutLike=o,this._handleDeleteLike=i,this._cardSelector=n}var t,n;return t=e,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this._setEventListeners(),this._element.querySelector(".element__image").src=this._image,this._element.querySelector(".element__title").textContent=this._title,this._element.querySelector(".element__image").alt=this._title,this._element.querySelector(".element__counter").textContent=this._likes.length,"0906fd565294f9f104e3db00"===this._ownerId&&(this._element.querySelector(".element__del").classList.add("element__del_visible"),this._element.querySelector(".element__del").removeAttribute("disabled","disabled")),this._element}},{key:"_setEventListeners",value:function(){var e=this;this._element.querySelector(".element__btn").addEventListener("click",this._handleLikeClick),this._element.querySelector(".element__del").addEventListener("click",(function(){e._handleDeleteCard(e._id,e._element)})),this._element.querySelector(".element__image").addEventListener("click",(function(t){e._handleCardClick(e._image,e._title)}))}}])&&d(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function m(e,t,n,r){var o=new y(e,"#card",(function(e,n){t.open(e,n)}),(function(e){return n.putLike(e)}),(function(e){n.deleteLike(e).then((function(e){console.log(e)})).catch((function(e){return console.log(e)}))}),(function(e,t){r.open().then((function(){n.deleteCard(e).then((function(){t.remove(),t=null})).catch((function(e){return console.log(e)}))}))}));return o.generateCard()}var v=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderedItems=r,this._renderer=o,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(){var e=this;this._renderedItems.forEach((function(t){e._renderer(t)}))}},{key:"addItem",value:function(e){this._container.prepend(e)}}])&&b(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._selector=t,this._popup=document.querySelector(this._selector),this._handleEscClose=this._handleEscClose.bind(this),this._handleClickOutsideClose=this._handleClickOutsideClose.bind(this),this._popupCloseBtn=this._popup.querySelector(".popup__close-btn"),this._galleryCloseBtn=this._popup.querySelector(".gallery__close-btn")}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose),this._popup.addEventListener("click",this._handleClickOutsideClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose),this._popup.removeEventListener("click",this._handleClickOutsideClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"_handleClickOutsideClose",value:function(e){e.target===e.currentTarget&&this.close()}},{key:"setEventListeners",value:function(){var e=this;this._popup.contains(this._popupCloseBtn)?this._popupCloseBtn.addEventListener("click",(function(){e.close()})):this._popup.contains(this._galleryCloseBtn)&&this._galleryCloseBtn.addEventListener("click",(function(){e.close()}))}}])&&k(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(){return w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=L(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},w.apply(this,arguments)}function L(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}function O(e,t){return O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},O(e,t)}function j(e,t){if(t&&("object"===C(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function P(e){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},P(e)}var q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=P(r);if(o){var n=P(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return j(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._popupSelector=e,t._gallery=document.querySelector(t._popupSelector),t._galleryImg=t._gallery.querySelector(".gallery__img"),t._gallerydescr=t._gallery.querySelector(".gallery__description"),t}return t=a,(n=[{key:"open",value:function(e,t){w(P(a.prototype),"open",this).call(this),this._galleryImg.src=e,this._galleryImg.alt=t,this._gallerydescr.textContent=t}}])&&E(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(S);function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(){return T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=R(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},T.apply(this,arguments)}function R(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}function U(e,t){return U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},U(e,t)}function A(e,t){if(t&&("object"===B(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}var z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=x(r);if(o){var n=x(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return A(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e))._popupSelector=e,n._popupWithForm=document.querySelector(n._popupSelector),n._handleFormSubmit=t,n._inputSelector=_.inputSelector,n._formSelector=_.formSelector,n._submitButtonSelector=_.submitButtonSelector,n._form=n._popupWithForm.querySelector(n._formSelector),n._submitButton=n._form.querySelector(n._submitButtonSelector),n._inputList=Array.from(n._form.querySelectorAll(n._inputSelector)),n}return t=a,(n=[{key:"_getInputValues",value:function(){var e={};return this._inputList.forEach((function(t){var n=t.getAttribute("name"),r=t.value;e[n]=r})),e}},{key:"renderLoading",value:function(e){if(e)this._submitButton.textContent="Сохранение...";else switch(this._submitButton.getAttribute("id")){case"add-submit":this._submitButton.textContent="Создать";break;case"edit-submit":case"avatar-submit":this._submitButton.textContent="Сохранить"}}},{key:"setEventListeners",value:function(){var e=this;T(x(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault();var n=e._getInputValues();e._handleFormSubmit(n)}))}},{key:"open",value:function(){T(x(a.prototype),"open",this).call(this);var e=this._submitButton;if(".popup_confirm"===this._popupSelector)return new Promise((function(t,n){e.addEventListener("click",(function(){t("Нажата кнопка Да")}))}))}},{key:"close",value:function(){T(x(a.prototype),"close",this).call(this),this._form.reset()}}])&&I(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(S);function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var N=function(){function e(t){var r=t.profileName,o=t.profileJob,i=t.profileAvatar;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._profileName=n.querySelector(r),this._profileJob=n.querySelector(o),this._profileAvatar=n.querySelector(i)}var t,r;return t=e,(r=[{key:"getUserInfo",value:function(){return{name:this._profileName.textContent,about:this._profileJob.textContent}}},{key:"setUserInfo",value:function(e){this._profileName.textContent=e.name,this._profileJob.textContent=e.about,this._profileAvatar.src=e.avatar}}])&&D(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var V=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=t.baseUrl,this._token=t.headers.authorization}var t,n;return t=e,(n=[{key:"getInitialCards",value:function(){return fetch("".concat(this._baseUrl,"/cards"),{headers:{authorization:this._token}}).then(v)}},{key:"postCard",value:function(e){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify(e)}).then(v)}},{key:"deleteCard",value:function(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(v)}},{key:"patchProfile",value:function(e){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify(e)}).then(v)}},{key:"getProfile",value:function(){return fetch("".concat(this._baseUrl,"/users/me"),{method:"GET",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(v)}},{key:"patchAvatar",value:function(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify(e)}).then(v)}},{key:"putLike",value:function(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(v)}},{key:"deleteLike",value:function(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(v)}}])&&J(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-42",headers:{authorization:"c06528dd-39b3-409c-b174-a8e7550ae360","Content-Type":"application/json"}}),F=new t(_,u),H=new t(_,s),W=new t(_,f),G=new q(".gallery"),M=new N({profileName:".profile__name",profileJob:".profile__description",profileAvatar:".profile__avatar"});V.getProfile().then((function(e){M.setUserInfo(e)})).catch((function(e){return console.log(e)}));var K=new z(".popup_edit",(function(e){K.renderLoading(!0),V.patchProfile(e).then((function(e){M.setUserInfo(e)})).catch((function(e){return console.log(e)})).finally((function(){K.renderLoading(!1),K.close()}))})),Q=new z(".popup_avatar",(function(e){Q.renderLoading(!0),V.patchAvatar(e).then((function(e){M.setUserInfo(e)})).catch((function(e){return console.log(e)})).finally((function(){Q.renderLoading(!1),Q.close()}))})),X=new z(".popup_confirm",(function(){X.close()}));F.enableValidation(),H.enableValidation(),W.enableValidation(),V.getInitialCards().then((function(e){var t=new g({items:e,renderer:function(e){var n=m(e,G,V,X);t.addItem(n)}},".elements");t.renderItems();var n=new z(".popup_add",(function(e){n.renderLoading(!0),V.postCard(e).then((function(e){var n=m(e,G,V,X);t.addItem(n)})).catch((function(e){return console.log(e)})).finally((function(){n.renderLoading(!1),n.close()}))}));n.setEventListeners(),o.addEventListener("click",(function(){H.resetErrors(),H.toggleButtonState(),n.open()}))})).catch((function(e){console.log(e)})),r.addEventListener("click",(function(){F.resetErrors();var e=M.getUserInfo();p.value=e.name,h.value=e.about,K.open()})),i.addEventListener("click",(function(){W.resetErrors(),W.toggleButtonState(),Q.open()})),G.setEventListeners(),K.setEventListeners(),Q.setEventListeners(),X.setEventListeners()})();